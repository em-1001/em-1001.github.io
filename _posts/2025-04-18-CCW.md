---
title:  "[Algorithm] Point In Polygon"
excerpt: "Point In Polygon test using ccw"

categories:
  - Algorithm
tags:
  - Algorithm
last_modified_at: 2025-04-18T08:06:00-05:00
---

# Point In Polygon

어떠한 점이 다각형 내부에 있는지, 외부에 있는지 판정하는 알고리즘을 알아볼 것이다. 

## CCW(Counter Clock Wise)

CCW는 벡터가 회전하는 방향을 판정하는 알고리즘으로 벡터의 외적을 이용하면 쉽게 구할 수 있다. 

세 점 $a, b, c$가 있을 때, 이 점들을 이용해 벡터 $\vec{ab}, \vec{bc}$를 만든다. 이 두 벡터의 외적값을 이용해 세 점에 대한 방향성을 판정한다. 

우선 3차원에서의 점 $\vec{p} = (p_x, p_y, p_z), \vec{q} = (q_x, q_y, q_z)$가 있을 때 두 벡터의 외적 $\vec{p} \times \vec{q}$는 $\vec{p} \times \vec{q} = (p_yq_z - p_zq_y, p_xq_z - p_zq_x, p_xq_y - p_yq_x)$로 나타낼 수 있고, $\vec{p} \times \vec{q}$의 방향은 오른손 법칙을 따른다. 

2차원에서의 벡터 외적은 3차원에서의 백터 외적에서 $z$좌표만 0으로 두면 된다. 두 벡터 $\vec{p}, \vec{q}$에 대해 $\vec{p} = (p_x, p_y, 0), \vec{q} = (q_x, q_y, 0)$로 나타낼 수 있고, $\vec{p} \times \vec{q} = (0, 0, p_xq_y - p_yq_x)$가 성립한다. 

오른손 법칙에 따라 $\vec{p}, \vec{q}$에 대해 $p_xq_y - p_yq_x$가 양수이면, $\vec{q}$는 $\vec{p}$로 부터 반시계 방향에 있고, 반대로 음수이면 $\vec{q}$는 $\vec{p}$로 부터 시계방향에 있다. 

세 개의 점 $a, b, c$가 주어졌을 때 벡터의 방향성 판단을 정리하면 다음과 같다. 

1. $\vec{ab} \times \vec{bc} > 0$  
$\vec{ab}$에 비교했을 때, $\vec{bc}$의 방향은 반시계 방향이다. (CCW)
2. $\vec{ab} \times \vec{bc} < 0$  
$\vec{ab}$에 비교했을 때, $\vec{bc}$의 방향은 시계 방향이다. (CW)
3. $\vec{ab} \times \vec{bc} = 0$  
점 $a, b, c$는 일직선 상에 위치한다.

CCW에서 정방향은 반시계이기 때문에, 결과가 반시계일 경우 1, 시계는 -1, 직선은 0으로 표현한다. 

c++구현은 다음과 같다. 

```cpp
typedef long long ll;
typedef pair<ll, ll> pll;

int ccw(pll a, pll b, pll c) {
    ll v1_x = b.X - a.X;
    ll v1_y = b.Y - a.Y;
    ll v2_x = c.X - b.X;
    ll v2_y = c.Y - b.Y;
    
    ll cross = v1_x * v2_y - v1_y * v2_x;
    
    if(cross > 0) return 1;
    if(cross < 0) return -1;
    return 0; 
}
```

CCW는 여러 용도로 사용이 가능한데 그 중 하나가 두 선분의 교차 판정이다. 두 선분에 대한 방정식을 세워 판정할 수도 있지만, CCW를 이용해 더 간단하게 풀 수 있다. 

<p align="center"><img src="https://github.com/user-attachments/assets/a221bec0-8a88-4801-b23b-71ab02547482" height="" width=""></p>

일반적으로는 위와 같이 선분 ab와 cd가 있을 때, 벡터 ab와 bc의 ccw, 벡터 ab와 bd의 ccw 곱이 0이하라면(즉, 둘의 ccw가 다르거나 0이 있다면) 두 선분이 교차한다고 할 수 있다. 

단, 몇가지 예외가 있는데, 

<p align="center"><img src="https://github.com/user-attachments/assets/b22bbcd6-b744-4bff-ac18-21889e7d78b7" height="" width=""></p>

위와 같은 경우 제대로 판정이 되지 않는다. 그래서 추가적으로 벡터 cd와 벡터 da의 ccw, 벡터 cd와 벡터 db의 ccw의 곱 또한 0이하인지 확인해야 한다. 

<p align="center"><img src="https://github.com/user-attachments/assets/deaa2d9b-07f1-4fdd-a8fc-fd38b358e38f" height="" width=""></p>

ccw의 곱 2개가 모두 0인 경우도 선분이 만나지 않을 수 있다. 이 경우 두 선분의 겹치는 부분이 존재하는지 추가적으로 확인해야 한다. 

ccw를 이용한 선분 교차 판정 구현은 다음과 같다. 


